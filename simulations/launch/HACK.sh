#!/bin/bash
#! Name of the job:
#SBATCH -J davids_stuff
#! Project name for Gilligan group,use SL2 for paying queue:
#SBATCH -A GILLIGAN-SL2-CPU
#! Output filename:
#SBATCH --output=davids_stuff_%A_%a.out 
#! Errors filename:
#SBATCH --error=davids_stuff_%A_%a.err 

#! How many whole nodes should be allocated?
#SBATCH --nodes=1
#! How many tasks will there be in total?
#SBATCH --ntasks=1
#! How many many cores will be allocated per task? 
#SBATCH --cpus-per-task=1 
#! Estimated runtime (job is force-stopped after if exceeded):
#SBATCH --time=01:00:00
#! Estimated memory needed (job is force-stopped if exceeded):
#SBATCH --mem=3420mb
#! Submit a job array with index values between 0 and n e.g. 0-100
#SBATCH --array=1,44,46,51,59,70,78,80,100,111,118,143,186,193,210,228,249,250,280,286,302,310,313,324,326,330,349,361,390,394,400,419,430,445,446,447,448,454,479,482,484,490,494,504,510,522,530,532,551,571,606,626,650,676,695,698,710,727,729,768,776,784,785,786,802,806,809,830,838,851,856,867,880,889,890,894,900,901,922,929,941,970,972,999,1003,1013,1016,1037,1068,1070,1077,1083,1090,1116,1130,1133,1140,1141,1159,1184,1194,1197,1229,1242,1261,1274,1290,1296,1312,1314,1318,1339,1354,1359,1362,1366,1375,1376,1388,1394,1417,1429,1436,1443,1445,1454,1459,1468,1484,1489,1490,1500,1503,1510,1511,1512,1513,1516,1524,1529,1533,1548,1553,1557,1574,1577,1593,1596,1652,1665,1672,1686,1704,1813,1818,1832,1842,1848,1861,1865,1872,1879,1884,1886,1892,1894,1896,1905,1932,1939,1943,1957,1966,1972,2002,2006,2008,2026,2027,2032,2038,2066,2071,2080,2084,2091,2097,2098,2100,2114,2120,2137,2149,2156,2166,2174,2189,2200,2202,2205,2232,2242,2245,2246,2267,2284,2287,2300,2302,2307,2319,2320,2336,2338,2369,2389,2404,2405,2416,2417,2425,2439,2440,2458,2462,2481,2482,2493,2498,2543,2549,2559,2566,2596,2599,2640,2643,2654,2658,2679,2689,2710,2711,2717,2721,2726,2732,2765,2773,2785,2793,2799,2800,2804,2807,2812,2835,2837,2841,2844,2857,2873,2935,2939,2949,2961,2967,2972,2992,2995,2999,3004,3033,3042,3044,3090,3104,3112,3131,3137,3160,3165,3189,3203,3220,3237,3240,3252,3261,3282,3316,3317,3335,3352,3374,3402,3403,3405,3409,3411,3437,3446,3447,3455,3460,3484,3489,3499,3505,3510,3529,3535,3548,3552,3562,3563,3575,3578,3579,3580,3612,3622,3629,3631,3639,3642,3666,3697,3713,3724,3738,3777,3788,3813,3823,3833,3861,3863,3866,3882,3886,3887,3899,3911,3929,3932,3933,3954,3962,3968,3979,3996,4010,4016,4026,4032,4033,4048,4052,4054,4071,4094,4111,4113,4120,4130,4140,4144,4145,4149,4166,4168,4178,4183,4190,4195,4218,4219,4229,4246,4249,4250,4259,4261,4264,4284,4293,4305,4307,4314,4325,4331,4386,4413,4438,4450,4455,4478,4482,4483,4487,4492,4497,4511,4519,4521,4554,4558,4570,4585,4604,4612,4615,4619,4621,4634,4636,4663,4665,4666,4690,4693,4699,4704,4719,4722,4727,4740,4752,4762,4773,4790,4803,4811,4813,4823,4831,4837,4861,4863,4867,4870,4878,4880,4900,4904,4905,4922,4934,4955,4980,4982,4989,5001,5018,5020,5028,5043,5059,5075,5077,5103,5116,5137,5160,5166,5170,5175,5181,5253,5255,5266,5273,5300,5308,5322,5340,5349,5353,5384,5391,5400,5406,5452,5462,5473,5493,5506,5539,5543,5550,5596,5605,5625,5635,5657,5674,5679,5690,5698,5709,5769,5775,5816,5822,5827,5829,5831,5868,5872,5874,5887,5893,5898,5908,5911,5912,5950,5952,5954,5962,5967,5980,5982,5988,5995,6008,6021,6025,6027,6034,6035,6058,6062,6069,6072,6086,6090,6093,6096,6099,6131,6134,6150,6159,6175,6181,6184,6193,6196,6205,6225,6226,6250,6270,6271,6282,6288,6303,6306,6312,6313,6318,6323,6324,6334,6349,6360,6383,6411,6419,6428,6433,6457,6460,6477,6480,6483,6504,6505,6528,6532,6537,6544,6551,6552,6579,6597,6619,6620,6624,6628,6635,6642,6646,6648,6649,6659,6660,6666,6684,6714,6722,6741,6749,6753,6762,6766,6769,6774,6784,6792,6800,6803,6821,6827,6829,6836,6859,6865,6866,6891,6896,6904,6907,6925,6926,6928,6934,6939

#! This is the partition name. This will request for a node with 6GB RAM for each task
#SBATCH -p cclake

#! mail alert at start,end and abortion of execution
#SBATCH --mail-type=ALL

#! Modify the environment seen by the application. For this example we need the default modules.
. /etc/profile.d/modules.sh                # This line enables the module command
module purge                               # Removes all modules still loaded
module load rhel7/default-peta4            # REQUIRED - loads the basic environment
module load use.own                        # This line loads the own module list
module load /rds/project/cag1/rds-cag1-general/epidem-modules/epidem.modules         # Loads Epidemiology group module list
module load miniconda3/4.9.2

# Conda set up
# >>> conda initialize >>>
# Contents within this block are managed by 'conda init' !!
__conda_setup="$('/rds/project/cag1/rds-cag1-general/epidem-programs/miniconda3/4.9.2/bin/conda' 'shell.bash' 'hook' 2> /dev/null)"
if [ $? -eq 0 ]; then
    eval "$__conda_setup"
else
    if [ -f "/rds/project/cag1/rds-cag1-general/epidem-programs/miniconda3/4.9.2/etc/profile.d/conda.sh" ]; then
        . "/rds/project/cag1/rds-cag1-general/epidem-programs/miniconda3/4.9.2/etc/profile.d/conda.sh"
    else
        export PATH="/rds/project/cag1/rds-cag1-general/epidem-programs/miniconda3/4.9.2/bin:$PATH"
    fi
fi
unset __conda_setup
# <<< conda initialize <<<

# --------------------------------------------------------

# SET THIS CORRECTLY PER PROJECT
conda activate /rds/project/cag1/rds-cag1-general/epidem-userspaces/dsg38/conda_env_default/dsg38

# Run stuff
Rscript ./my_pmpem_fix_tif_HACK.R $SLURM_ARRAY_TASK_ID
